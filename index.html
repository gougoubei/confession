<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>â¤ï¸</title>
<link rel="icon" href="data:,â¤ï¸">
<style>
  /* ---------- è§†è§‰ & å¸ƒå±€ ---------- */
  :root{
    --bg: #fff4f7;
    --accent: #f87581;
    --accent-2: #ff5264;
    --muted: #666;
    --card: #ffffff;
  }
  html,body{
    height:100%;
    margin:0;
    font-family: "Microsoft YaHei", "Segoe UI", Roboto, sans-serif;
    background: linear-gradient(180deg, var(--bg), #fff );
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    color:#222;
  }
  .container{
    max-width:800px;
    margin:16px auto;
    padding:16px;
  }
  header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
  }
  h1{ color:var(--accent); margin:0; font-size:1.4rem }
  .card{
    background:var(--card);
    border-radius:14px;
    padding:16px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.06);
    margin-top:12px;
  }
  #question{ font-size:1.15rem; margin:14px 0; color:#333 }
  .controls{ display:flex; gap:12px; align-items:center; justify-content:center; flex-wrap:wrap; }
  button, .pill{
    background:var(--accent);
    color:white;
    border:none;
    border-radius:10px;
    padding:10px 18px;
    font-size:1rem;
    cursor:pointer;
    transition: all .2s ease;
  }
  button:hover{ transform:scale(1.03); background:var(--accent-2) }
  .secondary{ background:#f1f1f1; color:#333 }
  .small{ padding:6px 10px; font-size:.9rem; border-radius:8px }
  .hint{ color:var(--muted); margin-top:8px; font-size:.95rem }
  .status{ text-align:center; margin-top:10px; font-weight:600 }
  .heart { font-size:3rem; animation:heartbeat 1.5s ease-in-out infinite both; }
  @keyframes heartbeat { from{transform:scale(1)} 50%{transform:scale(1.08)} to{transform:scale(1)} }

  /* tabs */
  .tabs{ display:flex; gap:6px; margin-top:12px; flex-wrap:wrap; }
  .tab{ background:#fff; border-radius:10px; padding:8px 12px; box-shadow:0 4px 12px rgba(0,0,0,0.03); cursor:pointer; border:1px solid transparent; }
  .tab.active{ border-color:var(--accent); color:var(--accent); }

  /* content areas */
  .area{ margin-top:12px; display:none; }
  .area.active{ display:block; }

  /* forms & lists */
  input[type=text], textarea, select {
    width:100%; padding:10px; border-radius:8px; border:1px solid #eee; box-sizing:border-box;
  }
  .row{ display:flex; gap:10px; }
  .col{ flex:1; }

  /* memory list & songs */
  .list-item{ padding:10px; border-radius:10px; background:#fff8fb; margin-bottom:8px; border:1px solid #ffe8ee; }

  /* success page */
  #successPage{ text-align:center; padding:36px 12px; display:none; }

  /* music control */
  .music-player{ position:fixed; right:18px; bottom:18px; z-index:999; }

  /* responsive tweaks */
  @media (max-width:520px){
    .container{ padding:12px; }
    h1{ font-size:1.2rem; }
    .controls{ flex-direction:column; }
  }
</style>
</head>
<body>
<div class="container">
  <header>
    <h1>ğŸ’˜</h1>
    <div>
      <button id="openMenuBtn" class="small">äº’åŠ¨ä¸­å¿ƒ</button>
    </div>
  </header>

  <!-- ä¸»äº’åŠ¨å¡ç‰‡ -->
  <div id="mainCard" class="card">
    <div id="question">åŠ è½½é—®é¢˜ä¸­...</div>

    <div class="controls">
      <button id="yesBtn">å¯ä»¥</button>
      <button id="noBtn" class="secondary">ä¸è¡Œ</button>
    </div>

    <div class="status" id="affection">äº²å¯†åº¦: 0/10</div>
    <div class="hint" id="hint">å¿«è¯•è¯•å›ç­”å§~</div>

    <div class="tabs" style="margin-top:14px;">
      <div class="tab active" data-tab="letter">ğŸ’Œ æƒ…ä¹¦ç”Ÿæˆ</div>
      <div class="tab" data-tab="games">ğŸ® å°æ¸¸æˆ</div>
      <div class="tab" data-tab="memory">ğŸ“¸ è®°å¿†ç›¸å†Œ</div>
      <div class="tab" data-tab="music">ğŸµ éŸ³ä¹å¿ƒæƒ…</div>
    </div>

    <!-- Tab å†…å®¹ -->
    <div id="letter" class="area active card" style="margin-top:10px;">
      <p>ç”Ÿæˆä¸€å°ä¸“å±æƒ…ä¹¦ç»™ä½ çš„ <strong id="nicknameDisplay">å°å¯çˆ±</strong></p>
      <button id="generateLetterBtn" class="small">ç”Ÿæˆæƒ…ä¹¦</button>
      <div id="letterOutput" style="margin-top:10px; color:#b23a4a; font-weight:600"></div>
    </div>

    <div id="games" class="area card">
      <h3>ğŸ® æƒ…ä¾£å°æ¸¸æˆ</h3>
      <select id="gameSelect">
        <option value="é»˜å¥‘">é»˜å¥‘æµ‹è¯•</option>
        <option value="çœŸå¿ƒè¯">çœŸå¿ƒè¯å¤§å†’é™©</option>
        <option value="æƒ…ä¾£é—®ç­”">æƒ…ä¾£é—®ç­”</option>
      </select>

      <!-- é»˜å¥‘æµ‹è¯• -->
      <div id="matchArea" style="margin-top:10px;">
        <div id="matchQuestion" style="font-weight:600; margin-bottom:8px"></div>
        <input id="matchAnswer" type="text" placeholder="è¾“å…¥ä½ çš„ç­”æ¡ˆ..." />
        <div style="margin-top:8px;">
          <button id="submitMatch" class="small">æäº¤ç­”æ¡ˆ</button>
          <button id="changeMatch" class="small secondary">æ¢ä¸€ä¸ªé—®é¢˜</button>
        </div>
        <div id="matchResult" style="margin-top:10px"></div>
      </div>

      <!-- çœŸå¿ƒè¯å¤§å†’é™© -->
      <div id="dareArea" style="display:none; margin-top:10px;">
        <div id="dareText" style="font-weight:600; margin-bottom:8px"></div>
        <button id="drawDare" class="small">æŠ½ä¸€ä¸ªæŒ‘æˆ˜</button>
      </div>

      <!-- æƒ…ä¾£é—®ç­”ï¼ˆç®€å•ï¼‰ -->
      <div id="quizArea" style="display:none; margin-top:10px;">
        <div id="quizQuestion" style="font-weight:600"></div>
        <input id="quizAnswer" placeholder="ä½ çš„å›ç­”..." />
        <button id="submitQuiz" class="small" style="margin-top:8px;">æäº¤</button>
        <div id="quizResult" style="margin-top:8px"></div>
      </div>
    </div>

    <div id="memory" class="area card">
      <h3>ğŸ“¸ æˆ‘ä»¬çš„è®°å¿†</h3>
      <p class="hint">è¿™é‡Œä¼šä¿å­˜åœ¨ä½ çš„æµè§ˆå™¨ï¼Œæœ¬è®¾å¤‡å¯è§</p>
      <textarea id="memText" rows="2" placeholder="è®°å½•ä¸€ä¸ªç¾å¥½ç¬é—´..."></textarea>
      <div style="margin-top:8px;">
        <button id="saveMem" class="small">ä¿å­˜è®°å¿†</button>
        <button id="clearMem" class="small secondary">æ¸…ç©ºæ‰€æœ‰è®°å¿†</button>
      </div>
      <div id="memList" style="margin-top:10px"></div>
    </div>

    <div id="music" class="area card">
      <h3>ğŸµ éŸ³ä¹å¿ƒæƒ…</h3>
      <p class="hint">é€‰ä¸€é¦–æ­Œå‘é€ç»™ä½ çš„å¿ƒæ„</p>
      <select id="songSelect">
        <option>ã€Šç”œç”œçš„ã€‹- å‘¨æ°ä¼¦</option>
        <option>ã€Šå°±æ˜¯çˆ±ä½ ã€‹- é™¶å–†</option>
        <option>ã€Šå°å¹¸è¿ã€‹- ç”°é¦¥ç”„</option>
        <option>ã€Šå‘Šç™½æ°”çƒã€‹- å‘¨æ°ä¼¦</option>
        <option>ã€Šç®€å•çˆ±ã€‹- å‘¨æ°ä¼¦</option>
        <option>ã€Šçˆ±ä½ ã€‹- ç‹å¿ƒå‡Œ</option>
        <option>ã€Šæµªæ¼«æ‰‹æœºã€‹- å‘¨æ°ä¼¦</option>
        <option>ã€Šæœ€é‡è¦çš„å†³å®šã€‹- èŒƒç®çª</option>
      </select>
      <div style="margin-top:8px;">
        <button id="sendSong" class="small">å‘é€æ­Œæ›²</button>
        <button id="clearSongs" class="small secondary">æ¸…ç©ºè®°å½•</button>
      </div>
      <div id="songsSent" style="margin-top:10px"></div>
    </div>
  </div>

  <!-- æˆåŠŸé¡µé¢ -->
  <div id="successPage" class="card" >
    <div id="successContent" style="display:none; text-align:center; padding:20px;">
      <div class="heart">â¤ï¸</div>
      <h2>!!å–œæ¬¢ä½ !!</h2>
      <p>( >â€¿< )â™¡Â°Â°</p>
      <p>æˆ‘ä»¬çš„æ•…äº‹æ‰åˆšåˆšå¼€å§‹...</p>
      <div style="margin-top:12px;">
        <button id="continueBtn" class="small">ç»§ç»­æˆ‘ä»¬çš„æ—…ç¨‹</button>
      </div>
    </div>
  </div>

  <!-- éŸ³ä¹æµ®åŠ¨æŒ‰é’® -->
  <div class="music-player">
    <button id="toggleMusicBtn" title="æ’­æ”¾/æš‚åœéŸ³ä¹">ğŸµ</button>
  </div>

</div>

<!-- èƒŒæ™¯éŸ³ä¹æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰ -->
<audio id="bgm" loop>
  <source src="bgm.mp3" type="audio/mp3">
  <!-- å¦‚æœæ²¡æœ‰ bgm.mp3ï¼Œä¹Ÿä¸ä¼šæŠ¥é”™ -->
</audio>

<script>
/* ========== å…¨å±€çŠ¶æ€ ========== */
const nickname = localStorage.getItem('nickname') || 'æŸæŸæŸ';
document.getElementById('nicknameDisplay').innerText = nickname;

let affection = Number(localStorage.getItem('affection') || 0);
let rejectCount = Number(localStorage.getItem('rejectCount') || 0);
let usedQuestions = JSON.parse(localStorage.getItem('usedQuestions') || '[]');
let sentSongs = JSON.parse(localStorage.getItem('sentSongs') || '[]');
let memories = JSON.parse(localStorage.getItem('memories') || '[]');

/* é—®é¢˜åº“ï¼ˆå’Œä½ çš„åŸç‰ˆä¸€è‡´ï¼‰ */
const questions = [
  `å¯ä»¥æˆä¸º ${nickname} çš„æ‹äººå—ï¼Ÿ`,
  `æ„¿æ„å’Œ ${nickname} ä¸€èµ·çœ‹æ˜Ÿæ˜Ÿå—ï¼Ÿ`,
  `å¯ä»¥ç»™ ${nickname} ä¸€ä¸ªæ‹¥æŠ±å—ï¼Ÿ`,
  `æ„¿æ„å’Œ ${nickname} å…±åº¦ä½™ç”Ÿå—ï¼Ÿ`,
  `å¯ä»¥æ¯å¤©å¯¹ ${nickname} è¯´æ—©å®‰å—ï¼Ÿ`,
  `æ„¿æ„å’Œ ${nickname} åˆ†äº«æ‰€æœ‰çš„å°ç§˜å¯†å—ï¼Ÿ`,
  `å¯ä»¥ç‰µèµ· ${nickname} çš„æ‰‹å—ï¼Ÿ`,
  `æ„¿æ„å’Œ ${nickname} ä¸€èµ·å…»åªå® ç‰©å—ï¼Ÿ`,
  `å¯ä»¥é™ª ${nickname} å»çœ‹æµ·å—ï¼Ÿ`,
  `æ„¿æ„æˆä¸º ${nickname} æœ€ç‰¹åˆ«çš„äººå—ï¼Ÿ`,
  `å¯ä»¥ç»™ ${nickname} å†™ä¸€å°æƒ…ä¹¦å—ï¼Ÿ`,
  `æ„¿æ„å’Œ ${nickname} ä¸€èµ·æ…¢æ…¢å˜è€å—ï¼Ÿ`
];

const rejectResponses = ["ä¸è®¸é€‰è¿™ä¸ª!", "ä¸è¦", "æˆ‘ä¼šå¾ˆä¼¤å¿ƒ..", "è¦ä¸å†æƒ³æƒ³?", "ï¼Ÿä½ è®¤çœŸçš„å—..", "ä¸è¡Œ("];

const loveLetters = [
  `äº²çˆ±çš„${nickname}ï¼Œé‡è§ä½ æ˜¯æˆ‘ä¸€ç”Ÿä¸­æœ€ç¾çš„æ„å¤–ã€‚`,
  `ç»™æœ€ç‰¹åˆ«çš„${nickname}ï¼šä½ çš„ç¬‘å®¹æ˜¯æˆ‘æ¯å¤©æœ€æœŸå¾…çš„é£æ™¯ã€‚`,
  `è‡´${nickname}ï¼šæˆ‘æƒ³æŠŠæ‰€æœ‰çš„æ¸©æŸ”éƒ½ç»™ä½ ï¼Œå› ä¸ºä½ å°±æ˜¯æˆ‘çš„å…¨ä¸–ç•Œã€‚`,
  `äº²çˆ±çš„${nickname}ï¼Œå’Œä½ åœ¨ä¸€èµ·çš„æ¯ä¸€åˆ»éƒ½å€¼å¾—çè—ã€‚`
];

/* ========== DOM å…ƒç´  ========== */
const questionEl = document.getElementById('question');
const yesBtn = document.getElementById('yesBtn');
const noBtn = document.getElementById('noBtn');
const affectionEl = document.getElementById('affection');
const hintEl = document.getElementById('hint');
const generateLetterBtn = document.getElementById('generateLetterBtn');
const letterOutput = document.getElementById('letterOutput');

const tabs = document.querySelectorAll('.tab');
const areas = document.querySelectorAll('.area');

const openMenuBtn = document.getElementById('openMenuBtn');
const mainCard = document.getElementById('mainCard');
const successContent = document.getElementById('successContent');
const successPage = document.getElementById('successPage');
const continueBtn = document.getElementById('continueBtn');

const bgm = document.getElementById('bgm');
const toggleMusicBtn = document.getElementById('toggleMusicBtn');

const matchQuestionEl = document.getElementById('matchQuestion');
const matchAnswerEl = document.getElementById('matchAnswer');
const submitMatchBtn = document.getElementById('submitMatch');
const changeMatchBtn = document.getElementById('changeMatch');
const matchResultEl = document.getElementById('matchResult');

const drawDareBtn = document.getElementById('drawDare');
const dareTextEl = document.getElementById('dareText');

const quizQuestionEl = document.getElementById('quizQuestion');
const quizAnswerEl = document.getElementById('quizAnswer');
const submitQuizBtn = document.getElementById('submitQuiz');
const quizResultEl = document.getElementById('quizResult');

const memText = document.getElementById('memText');
const saveMemBtn = document.getElementById('saveMem');
const clearMemBtn = document.getElementById('clearMem');
const memList = document.getElementById('memList');

const songSelect = document.getElementById('songSelect');
const sendSongBtn = document.getElementById('sendSong');
const songsSentEl = document.getElementById('songsSent');
const clearSongsBtn = document.getElementById('clearSongs');

/* ========== åˆå§‹åŒ–è§†å›¾ ========== */
function persistState(){
  localStorage.setItem('affection', affection);
  localStorage.setItem('rejectCount', rejectCount);
  localStorage.setItem('usedQuestions', JSON.stringify(usedQuestions));
  localStorage.setItem('sentSongs', JSON.stringify(sentSongs));
  localStorage.setItem('memories', JSON.stringify(memories));
}
function updateAffectionDisplay(){
  affectionEl.innerText = `äº²å¯†åº¦: ${affection}/10`;
  // æç¤ºæ–‡æ¡ˆ
  if(rejectCount === 0) hintEl.innerText = "å¿«è¯•è¯•å›ç­”å§~";
  else if(rejectCount === 1) hintEl.innerText = "ğŸ’” ä½ æ‹’ç»äº†æˆ‘å‡ æ¬¡å‘¢...å¿«ç‚¹å‡»åŒæ„æŒ‰é’®å§ï¼";
  else if(rejectCount <= 3) hintEl.innerText = "ğŸ’” ä½ å·²ç»æ‹’ç»æˆ‘å¥½å¤šæ¬¡äº†ï¼Œè¦ä¸è¦å†è€ƒè™‘ä¸€ä¸‹ï¼Ÿ";
  else hintEl.innerText = "ğŸ’” ä½ æ‹’ç»äº†æˆ‘è¿™ä¹ˆå¤šæ¬¡ï¼Œæˆ‘çœŸçš„å¥½ä¼¤å¿ƒ...å¿«ç‚¹å‡»é‚£ä¸ªå˜å¤§çš„åŒæ„æŒ‰é’®å§ï¼";
}
function chooseNewQuestion(){
  if (usedQuestions.length >= questions.length) usedQuestions = [];
  const available = questions.map((q,i)=>({q,i})).filter(x=>!usedQuestions.includes(x.i));
  const pick = available[Math.floor(Math.random()*available.length)];
  usedQuestions.push(pick.i);
  questionEl.innerText = pick.q;
}
function updateSentSongsUI(){
  songsSentEl.innerHTML = '';
  if(sentSongs.length === 0){
    songsSentEl.innerHTML = `<div class="hint">æš‚æ— å·²å‘é€çš„æ­Œæ›²</div>`;
    return;
  }
  const list = sentSongs.slice(-5).reverse();
  list.forEach(s=>{
    const div = document.createElement('div');
    div.className = 'list-item';
    div.innerText = `ğŸ¶ ${s}`;
    songsSentEl.appendChild(div);
  });
}
function updateMemUI(){
  memList.innerHTML = '';
  if(memories.length === 0){
    memList.innerHTML = `<div class="hint">æš‚æ— è®°å¿†</div>`;
    return;
  }
  const list = memories.slice().reverse();
  list.forEach((m,idx)=>{
    const d = document.createElement('div');
    d.className = 'list-item';
    d.innerHTML = `<div style="font-size:.95rem">${m}</div>
                   <div style="margin-top:6px; text-align:right;">
                     <button class="small secondary" data-idx="${memories.length-1-idx}" style="padding:6px 8px; font-size:.85rem;">åˆ é™¤</button>
                   </div>`;
    memList.appendChild(d);
  });
  // åˆ é™¤åŠŸèƒ½ç»‘å®š
  memList.querySelectorAll('button[data-idx]').forEach(btn=>{
    btn.addEventListener('click', (e)=>{
      const idx = Number(btn.getAttribute('data-idx'));
      memories.splice(idx,1);
      persistState(); updateMemUI();
    });
  });
}

/* åˆå§‹åŒ– */
updateAffectionDisplay();
if(!usedQuestions.length) chooseNewQuestion();
else questionEl.innerText = questions[usedQuestions[usedQuestions.length-1]];
updateSentSongsUI();
updateMemUI();

/* ========== äº’åŠ¨æŒ‰é’®é€»è¾‘ ========== */
yesBtn.addEventListener('click', ()=>{
  affection = Math.min(10, affection + 2);
  rejectCount = 0;
  // æ¢å¤æŒ‰é’®å¤§å°
  yesBtn.style.transform = 'scale(1)';
  persistState();
  updateAffectionDisplay();
  chooseNewQuestion();
  // è¾¾æˆæ¡ä»¶
  if(affection >= 10){
    showSuccess();
  }
});
noBtn.addEventListener('click', ()=>{
  const r = rejectResponses[Math.floor(Math.random()*rejectResponses.length)];
  noBtn.innerText = r;
  affection = Math.max(0, affection - 1);
  rejectCount++;
  const scale = Math.min(2.0, 1.0 + rejectCount * 0.2);
  yesBtn.style.transform = `scale(${scale})`;
  persistState();
  updateAffectionDisplay();
  if(rejectCount >= 3){
    // æç¤º
    hintEl.innerText += " ï¼ˆæç¤ºï¼šåŒæ„æŒ‰é’®å·²ç»å˜å¤§äº†ï¼‰";
  }
});

/* ========== æˆåŠŸé¡µ ========== */
function showSuccess(){
  mainCard.style.display = 'none';
  successContent.style.display = 'block';
  // æ°”çƒåŠ¨ç”»ï¼ˆç®€å• confettiï¼‰
  burstConfetti();
  // æ˜¾ç¤ºæˆåŠŸåŒºåŸŸ
  window.scrollTo({top:0,behavior:'smooth'});
  // å¦‚æœéœ€è¦å¯ä»¥é‡ç½®ä¸€äº›çŠ¶æ€
}
continueBtn.addEventListener('click', ()=>{
  // æ˜¾ç¤ºä¸»é¢æ¿å¹¶æ‰“å¼€äº’åŠ¨ä¸­å¿ƒï¼ˆé»˜è®¤æ˜¯ tabsï¼‰
  mainCard.style.display = 'block';
  successContent.style.display = 'none';
  // è‡ªåŠ¨è·³è½¬åˆ°äº’åŠ¨åŒº
});

/* ========== Tabs åˆ‡æ¢ ========== */
tabs.forEach(t=>{
  t.addEventListener('click', ()=>{
    tabs.forEach(x=>x.classList.remove('active'));
    t.classList.add('active');
    const tab = t.getAttribute('data-tab');
    areas.forEach(a=>{
      if(a.id === tab) a.classList.add('active');
      else a.classList.remove('active');
    });
  });
});

/* ========== æƒ…ä¹¦ç”Ÿæˆ ========== */
generateLetterBtn.addEventListener('click', ()=>{
  const txt = loveLetters[Math.floor(Math.random()*loveLetters.length)];
  letterOutput.innerText = txt;
});

/* ========== å°æ¸¸æˆ ========== */
/* é¢˜åº“ */
const matchQuestions = [
  `ä½ è§‰å¾—${nickname}æœ€å–œæ¬¢ä»€ä¹ˆé¢œè‰²ï¼Ÿ`,
  `${nickname}çš„ç”Ÿæ—¥æ˜¯ä»€ä¹ˆæ—¶å€™ï¼Ÿ`,
  `${nickname}æœ€çˆ±çš„é£Ÿç‰©æ˜¯ä»€ä¹ˆï¼Ÿ`,
  `${nickname}æœ€æƒ³å»å“ªé‡Œæ—…è¡Œï¼Ÿ`,
  `${nickname}æœ€å–œæ¬¢çš„ç”µå½±ç±»å‹æ˜¯ä»€ä¹ˆï¼Ÿ`
];
const dares = [
  "ç»™å¯¹æ–¹å‘ä¸€æ¡ç”œèœœçš„è¯­éŸ³æ¶ˆæ¯",
  "åˆ†äº«ä¸€ä¸ªä»æœªå‘Šè¯‰è¿‡åˆ«äººçš„å°ç§˜å¯†",
  "çº¦å®šä¸€ä¸ªæµªæ¼«çš„çº¦ä¼šè®¡åˆ’",
  "ä¸ºå¯¹æ–¹å”±ä¸€é¦–æ­Œ",
  "å†™ä¸‹ä¸€å¥æœ€æƒ³å¯¹å¯¹æ–¹è¯´çš„è¯"
];
const quizQs = [
  {q:`${nickname}ç¬¬ä¸€æ¬¡è§é¢çš„åœ°ç‚¹æ˜¯ï¼Ÿ`, a:''},
  {q:`${nickname}æœ€æ€•çš„äº‹æƒ…æ˜¯ä»€ä¹ˆï¼Ÿ`, a:''}
];

function pickMatch(){
  const q = matchQuestions[Math.floor(Math.random()*matchQuestions.length)];
  matchQuestionEl.innerText = q;
}
pickMatch();

submitMatchBtn.addEventListener('click', ()=>{
  const ans = matchAnswerEl.value.trim();
  if(!ans){ matchResultEl.innerText = "è¯·è¾“å…¥ç­”æ¡ˆåæäº¤"; return; }
  matchResultEl.innerText = `ä½ çš„ç­”æ¡ˆï¼š${ans}ï¼ˆä»…ä½œå¨±ä¹ï¼Œè®°å¾—å’ŒTAæ¯”å¯¹å“¦ï¼‰`;
  matchAnswerEl.value = '';
});
changeMatchBtn.addEventListener('click', ()=>{
  pickMatch();
  matchResultEl.innerText = '';
});

/* çœŸå¿ƒè¯å¤§å†’é™© */
drawDareBtn.addEventListener('click', ()=>{
  const d = dares[Math.floor(Math.random()*dares.length)];
  dareTextEl.innerText = d;
});

/* æƒ…ä¾£é—®ç­” */
submitQuizBtn.addEventListener('click', ()=>{
  const ans = quizAnswerEl.value.trim();
  if(!ans){ quizResultEl.innerText = "è¯·è¾“å…¥ç­”æ¡ˆåæäº¤"; return; }
  quizResultEl.innerText = `ä½ çš„å›ç­”å·²è®°å½•ï¼š${ans}ï¼ˆå¯ä½œä¸ºé»˜å¥‘å‚è€ƒï¼‰`;
  quizAnswerEl.value = '';
});

/* game select åˆ‡æ¢åŒºåŸŸæ˜¾ç¤º */
const gameSelect = document.getElementById('gameSelect');
function updateGameArea(){
  const v = gameSelect.value;
  document.getElementById('matchArea').style.display = v === 'é»˜å¥‘' ? 'block' : 'none';
  document.getElementById('dareArea').style.display = v === 'çœŸå¿ƒè¯' ? 'block' : 'none';
  document.getElementById('quizArea').style.display = v === 'æƒ…ä¾£é—®ç­”' ? 'block' : 'none';
}
gameSelect.addEventListener('change', updateGameArea);
updateGameArea();

/* ========== è®°å¿†ç›¸å†Œï¼ˆlocalStorageï¼‰ ========== */
saveMemBtn.addEventListener('click', ()=>{
  const t = memText.value.trim();
  if(!t) return alert('è¯·è¾“å…¥è¦ä¿å­˜çš„è®°å¿†');
  const stamp = new Date().toLocaleString();
  memories.push(`${stamp} - ${t}`);
  memText.value = '';
  persistState();
  updateMemUI();
});
clearMemBtn.addEventListener('click', ()=>{
  if(!confirm('ç¡®è®¤æ¸…ç©ºæ‰€æœ‰è®°å¿†å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼ˆä»…ä¿å­˜åœ¨æœ¬åœ°ï¼‰')) return;
  memories = [];
  persistState();
  updateMemUI();
});

/* ========== éŸ³ä¹å¿ƒæƒ… ========== */
sendSongBtn.addEventListener('click', ()=>{
  const song = songSelect.value;
  const stamp = new Date().toLocaleString();
  sentSongs.push(`${stamp} - ${song}`);
  persistState();
  updateSentSongsUI();
  // å‘é€åŠ¨ç”»ï¼ˆä¸´æ—¶ï¼‰ï¼Œå¹¶ä¸”æ°”çƒ
  burstConfetti(20);
});
clearSongsBtn.addEventListener('click', ()=>{
  if(!confirm('ç¡®è®¤æ¸…ç©ºå·²å‘é€æ­Œæ›²è®°å½•ï¼Ÿ')) return;
  sentSongs = [];
  persistState();
  updateSentSongsUI();
});

/* ========== music control ========== */
toggleMusicBtn.addEventListener('click', ()=>{
  if(bgm.paused){
    bgm.play().catch(()=>console.log('è‡ªåŠ¨æ’­æ”¾è¢«é˜»æ­¢'));
  }else bgm.pause();
});
// å°è¯•è‡ªåŠ¨æ’­æ”¾ï¼ˆç°ä»£æµè§ˆå™¨å¯èƒ½é˜»æ­¢è‡ªåŠ¨æ’­æ”¾ï¼Œç”¨æˆ·äº¤äº’åå¯æ’­æ”¾ï¼‰
window.addEventListener('load', ()=>{
  bgm.volume = 0.6;
  bgm.play().catch(()=>{ /* ignore autoplay block */ });
});

/* ========== è¾…åŠ©åŠ¨ç”»ï¼šconfetti æ°”çƒ ========== */
function burstConfetti(count=60){
  const colors = ['#ff4f6d','#ffb6c1','#ff69b4','#ffd6e0'];
  for(let i=0;i<count;i++){
    setTimeout(()=>{
      const el = document.createElement('div');
      el.style.position='fixed';
      el.style.zIndex=9999;
      el.style.left = (Math.random()*100) + 'vw';
      el.style.top = '-10vh';
      el.style.width = (8+Math.random()*12)+'px';
      el.style.height = (8+Math.random()*12)+'px';
      el.style.borderRadius='50%';
      el.style.background = colors[Math.floor(Math.random()*colors.length)];
      el.style.opacity = Math.random()*0.9+0.1;
      el.style.pointerEvents = 'none';
      document.body.appendChild(el);
      const endX = (Math.random()-0.5)*80;
      const duration = 2000 + Math.random()*1200;
      el.animate([
        { transform: `translate(0,0) rotate(0deg)` , opacity:1},
        { transform: `translate(${endX}px, ${window.innerHeight + 100}px) rotate(${Math.random()*360}deg)`, opacity:0.2}
      ], { duration: duration, easing: 'cubic-bezier(.2,.6,.2,1)' });
      setTimeout(()=>el.remove(), duration+200);
    }, Math.random()*400);
  }
}

/* ========== æ‰“å¼€/å…³é—­äº’åŠ¨ä¸­å¿ƒï¼ˆæµ®åŠ¨ï¼‰ ========== */
openMenuBtn.addEventListener('click', ()=>{
  window.scrollTo({top:0, behavior:'smooth'});
  // ç®€å•åˆ‡æ¢æ˜¾ç¤ºï¼ˆä¸»å¡ç‰‡ä¸€ç›´å±•ç¤ºï¼‰
});

/* ========== é¡µé¢å¸è½½æ—¶ä¿å­˜çŠ¶æ€ ========== */
window.addEventListener('beforeunload', persistState);

/* ========== æ¢å¤ UI çŠ¶æ€åˆå§‹æ˜¾ç¤º ========== */
updateAffectionDisplay();
updateSentSongsUI();
updateMemUI();

</script>
</body>
</html>
